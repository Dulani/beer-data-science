---
title: Data Science Musings on Beer
author:
  name: Amanda Dobbyn
date: "`r format(Sys.time(), '%B %d, %Y')`"
output: 
  html_document:
    keep_md: true
    toc: false
    theme: yeti
  github_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
# source("./read_from_db.R")
source("./cluster.R")
source("./plot.R")
library(knitr)
```

* Main motivation of the project
  * Are there natural clusters in beer that are defined by styles? Or are style boundaries more or less arbitrary?
    * Unsupervised (k-means) clustering based on 
      * ABV (alcohol by volume), IBU (international bitterness units), SRM (measure of color)
    * Style centers defined by mean of ABV, IBU, and SRM
      
* Answer
  * Looks more or less fluid: there aren't really pockets centered around a style
  

### General Workflow

* Hit the BreweryDB API to iteratively pull in all beers and their ingredients
  * Dump them into a MySQL database along with other things we'd want like breweries and glassware
* Unnest the JSON response including all the ingredients columns
* Create a `style_collapsed` column
  * Look for main style strings like `Pale Ale` and chop out everything else
  * Further collpase styles that are similar like Hefeweizen and Wit into Wheat
* Unnest the ingredients `hops` and `malts` into a sparse matrix
  * Individual ingredients as columns, beers as rows; cell gets a 1 if ingredient is present and 0 otherwise 

* Data courtesy of [BreweryDB](http://www.brewerydb.com/developers)
    * Special thanks to [Kris Kroksi](https://kro.ski/) for data ideation and beer


## Unsupervised Clustering 
* Pare down to beers that have ABV, IBU, and SRM
* K-means cluster beers based on these predictors

Compare popular styles      
```{r}
kable(style_centers)
```

A table of cluster counts broken down by style
```{r}
kable(cluster_table_counts)
```

Head of the data
```{r}
kable(head(beer_for_clustering))
```

Just the clusters
```{r}
clustered_beer_plot_abv_ibu
```


### Plot clusters related to style centers

```{r}
abv_ibu_clusters_vs_style_centers
```



### Ingredients

All hops types
```{r}
kable(all_hops_levels)
```

All malt types
```{r}
kable(all_malt_levels)
```

